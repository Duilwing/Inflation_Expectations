<!--loading necessary packages-->
```{r loading packages, include=FALSE, warning= FALSE}
#unsere packages
library(tidyverse)
library(readxl)
library(tinytex)
library(broom)
library(viridis) # color-schemes
library(knitr)
library(kableExtra)
library(stargazer) #Darstellung Tests/Regressionen
library(ggpubr) #Darstellung von mehreren plots in einer Abbildung

```

## Our Dataset


- we look at the survey data provided by the Survey of Consumer Expectations of the New York FED
- Q8v2,Q8v2part2,Q9 are relevant for the expectations

Dâ€™Acunto (2022):
- explains Survey of Consumer Expectations (SCE)
- shortcoming: only a small time series because not that old. "anchors" answers with their questions
- but overall good material
- disagreements increase volatility seen in covid19 2020 data
- looking at IQR
- only in the covid19 crisis short/long-term expectations differ


<!--short term Expectations by the SCE-->
```{r, include=FALSE, warning= FALSE}
#load data
SCE_Data <- read_excel("DATA/FRBNY-SCE-Data.xlsx", sheet = "Inflation expectations", skip = 2)

#rename columns, change format of the date column
SCE_Data <- SCE_Data %>%
  rename(Median=`Median one-year ahead expected inflation rate`,"Lower Quantil"=`25th Percentile one-year ahead expected inflation rate`, "Upper Quantil"=`75th Percentile one-year ahead expected inflation rate`,"Point Prediction"=`Median point prediction one-year ahead inflation rate`)%>%
  mutate(Date=...1*100+1)%>%
  select(c(2,4,6,8,10))%>%
  relocate(Date, .before = Median)

SCE_Data$Date <- as.Date(as.character(SCE_Data$Date),format = "%Y%m%d")



```

<!--Uncertainty data-->
```{r,include=FALSE, warning= FALSE}
SCE_Data_unc <- read_excel("DATA/FRBNY-SCE-Data.xlsx", sheet = "Inflation uncertainty", skip = 2)

SCE_Data_unc <- SCE_Data_unc%>%
  rename(Uncertainty=`Median one-year ahead uncertainty`)


```



<!--load Demographics-->
```{r, include=FALSE, warning= FALSE}
#load data from demographic sheet
SCE_Data_demo <- read_excel("DATA/FRBNY-SCE-Data.xlsx", sheet = "Inflation expectations Demo", skip = 3)

```


<!--CPI Data-->
```{r, include=FALSE, warning= FALSE}
#load CPI
cpi <- read_csv("DATA/CPIAUCSL.csv")

  
SCE_Data_summary <-bind_cols(SCE_Data, SCE_Data_unc[2],SCE_Data_demo[2:7],cpi[2])%>%
  rename("HS or Less"=`Education High School or Less`,"College"=`Education Some College`,"BA or Higher"=`Education BA or Higher`, CPI=CPIAUCSL_PC1)

```



- a plot of consumer expectations for one-year expectations of the last ten years give a first expression



```{r,echo=FALSE, warning=FALSE, fig.cap = "Short-term Expectations from 2013-present"}

#pivot longer
SCE_plot <- select(SCE_Data_summary,c(1,2,3,4,5,13))%>%
  pivot_longer(cols=c(2:6), names_to = "Measures", values_to = "Expectations", values_drop_na = FALSE)


#reihenfolge der quantile
SCE_plot$Measures <- factor(SCE_plot$Measures, levels = c("Lower Quantil","CPI","Median","Point Prediction","Upper Quantil"))


ggplot(data=SCE_plot) + aes(x=Date, y = Expectations, color = Measures) + geom_line(size=0.8)+scale_color_viridis(discrete = TRUE)+labs(x="Years", y="Monthly Expectations")+scale_x_date(date_labels = "%Y",date_breaks = "2 years")+ theme_minimal()



```

- we see different pattern of behavior which allwos us to split the data in two time intervals.
- we will analyze them in the next chapter descriptive statistics

\newpage


## Descriptive statistics

- we now look more into detail of the inflation expectations dataset
- we  also look at uncertainty, describe it


<!--Descriptive summaries-->
```{r, include=FALSE, warning= FALSE}
#sub-data sets for both intervals

SCE_Data_01 <- SCE_Data_summary%>%
  filter(Date<"2020-03-01")

SCE_Data_02 <- SCE_Data_summary%>%
  filter(Date>"2020-02-01")


#summary for first interval 13-20
sum_01 <- SCE_Data_01%>%
  summarise(Mean = mean(Median),
            Volatility = sd(Median))%>%
  mutate(Measure="Median")%>%
  relocate(Measure, .before = Mean)

sum_02 <- SCE_Data_01%>%
  summarise(Mean = mean(`Point Prediction`),
            Volatility = sd(`Point Prediction`))%>%
  mutate(Measure="Point Prediction")%>%
  relocate(Measure, .before = Mean)

sum_03 <- SCE_Data_01%>%
  summarise(Mean = mean(Uncertainty),
            Volatility = sd(Uncertainty))%>%
  mutate(Measure="Uncertainty")%>%
  relocate(Measure, .before = Mean)

sum_04 <- SCE_Data_01%>%
  summarise(Mean = mean(CPI),
            Volatility = sd(CPI))%>%
  mutate(Measure="CPI")%>%
  relocate(Measure, .before = Mean)


#summary for second interval

sum_05 <- SCE_Data_02%>%
  summarise(Mean = mean(Median),
            Volatility = sd(Median))%>%
  mutate(Measure="Median")%>%
  relocate(Measure, .before = Mean)

sum_06 <- SCE_Data_02%>%
  summarise(Mean = mean(`Point Prediction`),
            Volatility = sd(`Point Prediction`))%>%
  mutate(Measure="Point Prediction")%>%
  relocate(Measure, .before = Mean)

sum_07 <- SCE_Data_02%>%
  summarise(Mean = mean(Uncertainty),
            Volatility = sd(Uncertainty))%>%
  mutate(Measure="Uncertainty")%>%
  relocate(Measure, .before = Mean)

sum_08 <- SCE_Data_02%>%
  summarise(Mean = mean(CPI),
            Volatility = sd(CPI))%>%
  mutate(Measure="CPI")%>%
  relocate(Measure, .before = Mean)


```

- we can see two different phases for inflation expectations: from June 2013 until April 2020 and from May 2020 until today
- first phase: stable expectations with median and point predictions at around 2.5-3.0% inflation
- second phase: sudden increase in expectations with a peak at arond 6.5% in the last months


```{r,echo=FALSE, warning=FALSE}
summary_01 <- bind_rows(sum_01,sum_02, sum_03, sum_04)  


#darstellung mit kableExtra
  knitr::kable(summary_01,
  digits = 4,caption="Summary for expectations from 2013-2020")%>%
    kable_styling(latex_options = c("striped"))
```

```{r,echo=FALSE, warning=FALSE}
summary_02 <- bind_rows(sum_05,sum_06,sum_07,sum_08)  


#darstellung mit kableExtra
  knitr::kable(summary_02,
  digits = 4,caption="Summary for expectations from 2020-present")%>%
    kable_styling(latex_options = c("striped"))
```
- we see higher values for average median, point estimate, volatility and uncertainty and therefore a wider range in the second sample


\newpage


## Some Demographic Differences

-we look at two major differences at the demographic level of our data set, namely sex and age

<!--Distribution function Age-->
```{r, echo=FALSE, warning=FALSE, fig.cap = "Distribution function for Age Groups"}
#show distribution for Age and Education

SCE_Data_age <- SCE_Data_summary%>%
  select(c(1,7:9))%>%
  rename(`Under 40`=`Age Under 40`,`40-60`=`Age 40-60`,`Over 60`=`Age Over 60`)%>%
  pivot_longer(cols=c(2:4), names_to = "Age Groups", values_to = "Expectations", values_drop_na = FALSE)

#Rang of Age Groups
SCE_Data_age$`Age Groups` <- factor(SCE_Data_age$`Age Groups`, levels = c("Under 40","40-60","Over 60"))


ggplot(data=SCE_Data_age, aes(x=Expectations, group=`Age Groups`, fill=`Age Groups`)) + geom_density(adjust=0.8, alpha=0.75) + scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) + labs(x="Inflation Expectations",y="Density")+scale_x_continuous(breaks = seq(0, 8, by = 1))+ theme_minimal()

```


<!--Distribution function Education-->
```{r, echo=FALSE, warning=FALSE, fig.cap = "Distribution function for Education Groups"}
#show distribution for Education

SCE_Data_ed <- SCE_Data_summary%>%
  select(c(1,10:12))%>%
  pivot_longer(cols=c(2:4), names_to = "Education Levels", values_to = "Expectations", values_drop_na = FALSE)

#Rang of Education Levels
SCE_Data_ed$`Education Levels` <- factor(SCE_Data_ed$`Education Levels`, levels = c("HS or Less","College","BA or Higher"))


ggplot(data=SCE_Data_ed, aes(x=Expectations, group=`Education Levels`, fill=`Education Levels`)) + geom_density(adjust=0.8, alpha=0.75) + scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) + labs(x="Inflation Expectations",y="Density")+scale_x_continuous(breaks = seq(0, 7, by = 1))+ theme_minimal()

```


- the next dataset contains the google searches for inflation or inflation rate in the US

<!--Trends data for USA-->
```{r, include=FALSE, warning= FALSE}
#loading the data
infl_US <- read_delim("DATA/infl_US.csv",delim = ";", escape_double = FALSE, col_types = cols(Monat = col_date(format = "%d/%m/%Y")), trim_ws = TRUE)

infl_r_US <- read_delim("DATA/infl_r_US.csv",delim = ";", escape_double = FALSE, col_types = cols(Monat = col_date(format = "%d/%m/%Y")), trim_ws = TRUE)

```


<!--Google trends for USA-->
```{r, echo=FALSE, warning=FALSE, fig.cap = "US Google Trends Results for Inflation/Inflation rate from 2010-present"}

infl_summary <- bind_cols(infl_US,infl_r_US)%>%
  select(c(1,2,4,))%>%
  rename(Date=Monat...1,Inflation=`inflation: (Vereinigte Staaten)`,"Inflation rate"=`inflation rate: (Vereinigte Staaten)`)

infl_plot <- infl_summary%>%
  pivot_longer(cols=2:3, names_to = "Searched Terms", values_to = "Relative Rankings", values_drop_na = FALSE)

ggplot(data=infl_plot) + aes(x=Date, y =`Relative Rankings`, color =`Searched Terms`) + geom_line(size=0.9,alpha=1)+scale_color_manual(values=c("#00798c","#B9314F"))+labs(x="Years")+scale_x_date(date_labels = "%Y",date_breaks = "1 year")+ theme_minimal()  


```

- google trends for the US show stable behavior until second half of 2021, after that huge increase
- inflation and inflation rate are very similar in their relative search frequency
- we will later combine these data with the SCE data set in some regression models

We are now able to look at first results for our two hypothesis:

\begin{itemize}
  \item \(H_1:\) There is a positive correlation between aggregated inflation expectations and uncertainty, Google searches and the actual inflation.
  \item \(H_2:\) There is a positive correlation between Google searches and updating behavior of individual consumers.
\end{itemize}


Without regression we can still see higher volatility in inflation expectations and higher spreads between the upper and lower quantil. This implies higher uncertainty leads to higher inflation expectations. The time series for Google Searches shows a similar behavior like the SCE time series for Inflation expectations. This hints to a link between searching behavior and a rise in inflation in the last two years. In the next chapter we will first introduce the microdata for the SCE survey, compute aspects of updating behavior and proof our hypothesis with several regressions.

\newpage