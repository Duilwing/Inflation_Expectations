---
output:
  pdf_document: default
  html_document: default
---

## Updating Behavior

Before we continue to explore the relationships between expectations and different variables within our data we have to take a look at the microdata of the SCE. To analyze individual behavior, for example in updating their exceptions and its relationship with google searches or inflation expectations this thesis uses a similar approach as in the paper "Updating inflation expectations: Evidence from micro-data" by @Drager.2017. Dr√§ger et al. use microdata from the Survey of Consumers conducted by the University of Michigan (MSC) from 78-2011. In this survey some participants are questioned a second time, whichs allows @Drager.2017 to show individual updating behavior by computing updating shares and updating frequency. 
For the updating frequency @Drager.2017 receive eight or 16 months for the quantitative and qualitative questions targeting at inflation expectations in the short run. @Drager.2017 demonstrate $74.1%$ in updating share for the quantitative and $38.2%$ for the qualitative answer, with higher spreads for the qualitative answer. The crises of 2001 and 2008 also increased shares significantly.
@Drager.2017 conclude that updating behavior depends on the business cycle fluctuations, with higher shares and frequency around crises and lower adjustments for stable conditions and long-term expectations.

This thesis validates these finding by analyzing the updating behavior of individuals within the SCE. For this, the focus is layed on the quantitative answers that are aggregated to the already established point prediction. 



<!--Clean environment-->
```{r, echo=FALSE, warning= FALSE}
#we only need SCE_Data_summary,infl_summary

rm(list=ls()[! ls() %in% c("SCE_Data_summary","infl_summary")])

```


<!--Micro data by the SCE-->
```{r, echo=FALSE, warning= FALSE}

#load all data
SCE_micro_13 <- read_excel("DATA/FRBNY-SCE-Public-Microdata-Complete-13-16.xlsx")
SCE_micro_17 <- read_excel("DATA/FRBNY-SCE-Public-Microdata-Complete-17-19.xlsx")
SCE_micro_20 <- read_excel("DATA/frbny-sce-public-microdata-latest.xlsx")
```

<!--Micro data by the SCE Part2-->
```{r, echo=FALSE, warning= FALSE}

#combine in one
SCE_micro <- bind_rows(SCE_micro_13,SCE_micro_17,SCE_micro_20)
#delete all rows with NAs
SCE_micro <- SCE_micro[!is.na(SCE_micro$Q8v2part2),]
#tidy up
SCE_micro <- SCE_micro %>%
  rename(Expectation=Q8v2part2)%>%
  mutate(Date=date*100+1)%>%
  relocate(Date, .before = userid)%>%
  group_by(userid)%>%
  mutate(last_exp=lag(Expectation))%>% 
  mutate(last_exp = coalesce(last_exp,Expectation))%>%
  mutate(dummy=case_when(Expectation-last_exp==0
 ~ 0,Expectation-last_exp!=0 ~ 1))%>%
  select(!date)%>%
  ungroup(userid)

SCE_micro$Date <- as.Date(as.character(SCE_micro$Date),format = "%Y%m%d")

SCE_micro_1 <- SCE_micro%>%
  group_by(userid)%>%
  summarise(updating_count = sum(dummy))

SCE_micro_2 <- SCE_micro%>%
  group_by(userid)%>%
  summarise(Tenure = max(tenure))

SCE_micro_3 <- SCE_micro%>%
  group_by(userid)%>%
  summarise("Age Groups"=Age_Cat)%>%
  slice(1)

SCE_micro_frequency <-bind_cols(SCE_micro_1, SCE_micro_2[2],SCE_micro_3[2])%>%
  mutate("Updating Frequency"=updating_count/Tenure)%>%
  filter(Tenure>=2)

#filter NAs
SCE_micro_frequency <- SCE_micro_frequency[!is.na(SCE_micro_frequency$`Age Groups`),]

 
SCE_micro_frequency_summary <- SCE_micro_frequency%>%
  summarise(Mean=mean(`Updating Frequency`),
            Volatility=sd(`Updating Frequency`))%>%
  mutate(Measure="Updating Frequency")%>%
  relocate(Measure, .before = Mean)


#table for the frequency
knitr::kable(SCE_micro_frequency_summary,
  digits = 4,caption="Summary for Updating Frequency")%>%
    kable_styling(latex_options = c("striped"))

#avg. frequency in months
#mean(SCE_micro_frequency$Tenure)*mean(SCE_micro_frequency$`Updating Frequency`)
#[1] 3.354507
```

After combining all available microdata published by the SCE the updating frequency of all participants is presented in Table 3 and Figure 5. The average updating frequency is determined as 0.4505. With an average tenure of 7.45 months, households update their expectations every 4 months. Figure 5 shows the density function for the whole sample distinguished for the three age categories. Other demographic differences like education and income result in similar distributions. As clearly seen all age groups follow a general pattern with only minor differences. There is a significant part of participants that do not upgrade their expectations at all. This behavior is shown by around 20% in the whole sample with participants usually updating more often. If all observations without updating are ignored the updating frequency increases to 0.53556 and therefore every 5 months.


<!--Plot Micro data distribution of updating frequency by the SCE all in one-->
```{r, echo=FALSE, warning=FALSE, fig.cap = "Distribution of Updating Frequency from the Micro-data"}
#reihenfolge
SCE_micro_frequency$`Age Groups` <- factor(SCE_micro_frequency$`Age Groups`, levels = c("Under 40","40 to 60","Over 60"))

ggplot(data=SCE_micro_frequency, aes(x=`Updating Frequency`, group=`Age Groups`, fill=`Age Groups`)) + geom_density(adjust=0.8, alpha=0.75) + scale_fill_viridis(discrete=TRUE) +scale_color_viridis(discrete=TRUE) + labs(x="Updating Frequency",y="Density")+scale_x_continuous(breaks = seq(0, 10, by = 1))+ theme_minimal()

```


<!--Plot Micro data updating share by the SCE all in one-->
```{r, echo=FALSE, warning=FALSE, fig.cap = "Updating Shares from the Micro-data"}

SCE_micro_4_y <- SCE_micro%>%
  filter(Age_Cat=="Under 40")%>%
  count(Date)

SCE_micro_4_m <- SCE_micro%>%
  filter(Age_Cat=="40 to 60")%>%
  count(Date)

SCE_micro_4_o <- SCE_micro%>%
  filter(Age_Cat=="Over 60")%>%
  count(Date)

SCE_micro_5_y <- SCE_micro%>%
  filter(Age_Cat=="Under 40")%>%
  group_by(Date)%>%
  summarise(monthly_count = sum(dummy))

SCE_micro_5_m <- SCE_micro%>%
  filter(Age_Cat=="40 to 60")%>%
  group_by(Date)%>%
  summarise(monthly_count = sum(dummy))

SCE_micro_5_o <- SCE_micro%>%
  filter(Age_Cat=="Over 60")%>%
  group_by(Date)%>%
  summarise(monthly_count = sum(dummy))


SCE_micro_summary_y <-bind_cols(SCE_micro_4_y, SCE_micro_5_y[2])%>%
  filter(monthly_count>0)%>%
  mutate("Updating share"=monthly_count/n)%>%
  mutate("Age Groups"="Under 40")

SCE_micro_summary_m <-bind_cols(SCE_micro_4_m, SCE_micro_5_m[2])%>%
  filter(monthly_count>0)%>%
  mutate("Updating share"=monthly_count/n)%>%
  mutate("Age Groups"="40 to 60")

SCE_micro_summary_o <-bind_cols(SCE_micro_4_o, SCE_micro_5_o[2])%>%
  filter(monthly_count>0)%>%
  mutate("Updating share"=monthly_count/n)%>%
  mutate("Age Groups"="Over 60")

SCE_micro_summary <- bind_rows(SCE_micro_summary_y,SCE_micro_summary_m,SCE_micro_summary_o)


SCE_micro_summary$`Age Groups` <- factor(SCE_micro_summary$`Age Groups`, levels = c("Under 40","40 to 60","Over 60"))

ggplot(data=SCE_micro_summary) + aes(x=Date, y = `Updating share`, color = `Age Groups`) + geom_line(size=0.8)+scale_color_viridis(discrete = TRUE)+labs(x="Years")+scale_x_date(date_labels = "%Y",date_breaks = "2 years")+ theme_minimal()

```

Figure 6 shows the updating share over the whole sample again for the three different age groups. Over the full sample the average updating share is 0.5706. All three age groups show similar behavior with old participants with slightly higher updating shares. The microdata reveal an updating spike at the beginning of the Covid19-Crises but cannot show a possible manifastation of increasing updating due to the lack of data after July 2021. In Chapter 5 we will discuss in more depth the limitations of the provided microdata.

Comparing the results from the SCE with the findings of @Drager.2017, fewer participants update their expectations every month, but with a higher frequency. The next chapter deals via the use of regression models with the relationships between updating behavior, searching behavior and expectations.


## Regressions

-due to the shorter time series for the micro data we build two different regression tables with then we perform the different regressions

<!--Clean environment-->
```{r, echo=FALSE, warning= FALSE}
#we only need SCE_Data_summary,infl_summary and SCE_micro

rm(list=ls()[! ls() %in% c("SCE_Data_summary","infl_summary", "SCE_micro","SCE_micro_frequency")])

```


<!--Regressions-->
```{r, include=FALSE, warning= FALSE}
#transfer data into big regression summary, but without updating behavior
SCE_Data_regressions <-bind_cols(SCE_Data_summary,infl_summary[42:148,2:3])%>%
  rename(GS_infl=Inflation, GS_infl_r=`Inflation rate`)

#second regression table for updating and Google searches
SCE_micro_1 <- SCE_micro%>%
  count(Date)

SCE_micro_2 <- SCE_micro%>%
  group_by(Date)%>%
  summarise(monthly_count = sum(dummy))

SCE_micro_summary <-bind_cols(SCE_micro_1, SCE_micro_2[2])%>%
  filter(monthly_count>0)%>%
  mutate("Updating share"=monthly_count/n)

SCE_Data_regressions_micro <-bind_cols(SCE_Data_summary[2:98,],SCE_micro_summary[4],infl_summary[43:139,2:3])%>%
rename(GS_infl=Inflation, GS_infl_r=`Inflation rate`)

```

We have now regressions to test our first hypothesis:

-there is a positive correlation between aggregated inflation expectations and uncertainty, Google searches and the actual inflation

To avoid heteroscedasticity we only use the search term inflation weil hier mehr leute suchen.

-first regression model with aggregated data: uncertainty~ GS_infl
-second regression model with aggregated data: Median~ GS_infl
- third regression model with aggregated data: median of exp~ GS_infl+Uncertainty+CPI

<!--Regression Model aggregated data-->
```{r, echo=FALSE, warning=FALSE, results='asis'}

#regression models
attach(SCE_Data_regressions)
model1 <- lm(Uncertainty~GS_infl)
model2 <- lm(Median~ GS_infl)
model3 <- lm(`Point Prediction`~ GS_infl+Uncertainty+CPI)
detach(SCE_Data_regressions)

#results for full sample aggr. data
stargazer(model1,model2,model3, header=FALSE, type='latex',model.numbers= FALSE,title = "Regressions for aggregated Data, full sample",omit.stat = c("rsq", "f"))


```


- we also differ between the two sub time-series to analyze if the correlations differ in the two phases

<!--Regression Model aggregated data sub-->
```{r, echo=FALSE, warning=FALSE}

#building sub sets
SCE_Data_regressions_01 <- SCE_Data_regressions%>%
  filter(Date<"2020-03-01")

SCE_Data_regressions_02 <- SCE_Data_regressions%>%
  filter(Date>"2020-02-01")

```

-we build two models for the first interval to analyze the effect of CPI

<!--Regression Models aggregated data sub1-->
```{r, echo=FALSE, warning=FALSE, results='asis'}

attach(SCE_Data_regressions_01)
model1_01 <- lm(Uncertainty~GS_infl)
model2_01 <- lm(Median~GS_infl)
model3_01 <- lm(`Point Prediction`~ GS_infl+Uncertainty+SCE_Data_regressions_01$CPI)
detach(SCE_Data_regressions_01)

stargazer(model1_01,model2_01,model3_01, header=FALSE, type='latex',model.numbers= FALSE,title = "Regressions for aggregated Data, sample from 06/13-02/20",omit.stat = c("rsq", "f"))

```

- we do the same regressions with our second sub time-series

<!--Regression Models aggregated data sub2-->
```{r, echo=FALSE, warning=FALSE, results='asis'}

attach(SCE_Data_regressions_02)
model1_02 <- lm(Uncertainty~GS_infl)
model2_02 <- lm(Median~GS_infl)
model3_02 <- lm(`Point Prediction`~ GS_infl+Uncertainty+SCE_Data_regressions_02$CPI)
detach(SCE_Data_regressions_02)

stargazer(model1_02,model2_02,model3_02, header=FALSE, type='latex',model.numbers= FALSE,title = "Regressions for aggregated Data, sample 03/20-04/22",omit.stat = c("rsq", "f"))




```

We can now look at the second hypothesis:

-there is a positive correlation between Google searches and updating behavior of individual consumers
-use of different models with different directions of the relationship

<!--Regression Model micro data 1-->
```{r, echo=FALSE, warning=FALSE, results='asis'}
#regressions for micro data
attach(SCE_Data_regressions_micro)
model1_micro <- lm(`Updating share`~ GS_infl)
model2_micro <- lm(`Updating share`~ Uncertainty)
model3_micro <- lm(GS_infl~ `Updating share`)
model4_micro <- lm(Uncertainty ~ `Updating share`)

stargazer(model1_micro,model2_micro,model3_micro,model4_micro, header=FALSE, type='latex',model.numbers= FALSE,title = "Regressions for Micro-Data",omit.stat = c("rsq", "f"))


```





