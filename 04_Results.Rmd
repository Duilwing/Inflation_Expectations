---
output:
  pdf_document: default
  html_document: default
---

## Updating Behavior

Before we continue to explore the relationships between expectations and different variables within our data we have to take a look at the microdata of the SCE. To analyze individual behavior, for example in updating their exceptions and its relationship with google searches or inflation expectations this thesis uses a similar approach as in the paper "Updating inflation expectations: Evidence from micro-data" by @Drager. Dr√§ger et al. use microdata from the Survey of Consumers conducted by the University of Michigan (MSC) from 78-2011. In this survey some participants are questioned a second time, whichs allows @Drager to show individual updating behavior by computing updating shares and updating frequency. 
For the updating frequency @Drager receive eight or 16 months for the quantitative and qualitative questions targeting at inflation expectations in the short run. @Drager demonstrate $74.1%$ in updating share for the quantitative and $38.2%$ for the qualitative answer, with higher spreads for the qualitative answer. The crises of 2001 and 2008 also increased shares significantly.
@Drager conclude that updating behavior depends on the business cycle fluctuations, with higher shares and frequency around crises and lower adjustments for stable conditions and long-term expectations.

This thesis validates these finding by analyzing the updating behavior of individuals within the SCE. For this, the focus is layed on the quantitative answers that are aggregated to the already established point prediction. 

<!--Micro data by the SCE-->
```{r, echo=FALSE, warning= FALSE}

#load all data
SCE_micro_13 <- read_excel("DATA/FRBNY-SCE-Public-Microdata-Complete-13-16.xlsx")
SCE_micro_17 <- read_excel("DATA/FRBNY-SCE-Public-Microdata-Complete-17-19.xlsx")
SCE_micro_20 <- read_excel("DATA/frbny-sce-public-microdata-latest.xlsx")

#combine in one
SCE_micro <- bind_rows(SCE_micro_13,SCE_micro_17,SCE_micro_20)
#delete all rows with NAs
SCE_micro <- SCE_micro[!is.na(SCE_micro$Q8v2part2),]
#tidy up
SCE_micro <- SCE_micro %>%
  rename(Expectation=Q8v2part2)%>%
  mutate(Date=date*100+1)%>%
  select(2:5)%>%
  relocate(Date, .before = userid)%>%
  group_by(userid)%>%
  mutate(last_exp=lag(Expectation))%>% 
  mutate(last_exp = coalesce(last_exp,Expectation))%>%
  mutate(dummy=case_when(Expectation-last_exp==0
 ~ 0,Expectation-last_exp!=0 ~ 1))%>%
  ungroup(userid)

SCE_micro$Date <- as.Date(as.character(SCE_micro$Date),format = "%Y%m%d")

SCE_micro_1 <- SCE_micro%>%
  count(Date)

SCE_micro_2 <- SCE_micro%>%
  group_by(Date)%>%
  summarise(monthly_count = sum(dummy))

SCE_micro_3 <- SCE_micro%>%
  group_by(userid)%>%
  summarise(updating_count = sum(dummy))

SCE_micro_4 <- SCE_micro%>%
  group_by(userid)%>%
  summarise(Tenure = max(tenure))

SCE_micro_frequency <-bind_cols(SCE_micro_3, SCE_micro_4[2])%>%
  mutate("Updating Frequency"=updating_count/Tenure)

SCE_micro_frequency_summary <- SCE_micro_frequency%>%
  summarise(Mean=mean(`Updating Frequency`),
            Volatility=sd(`Updating Frequency`))%>%
  mutate(Measure="Updating Frequency")%>%
  relocate(Measure, .before = Mean)


#table for the frequency
knitr::kable(SCE_micro_frequency_summary,
  digits = 4,caption="Summary for Updating Frequency")%>%
    kable_styling(latex_options = c("striped"))

#avg. frequency in months
#mean(SCE_micro_frequency$Tenure)*mean(SCE_micro_frequency$`Updating Frequency`)
#[1] 3.325523
```

Table shows a summary for the updating frequency of the whole sample


<!--Plot Micro data distribution of updating frequency by the SCE all in one-->
```{r, echo=FALSE, warning=FALSE, fig.cap = "Distribution of Updating Frequency from the Micro-data"}
x<- filter(SCE_micro_frequency,updating_count>0)

ggplot(data=SCE_micro_frequency, aes(x=`Updating Frequency`)) + geom_density(adjust=1, alpha=0.6,color="#440154FF", fill="#440154FF") + labs(x="Updating Frequency in Percent",y="Density") +scale_x_continuous(breaks = seq(0, 1, by = 0.1))+ theme_minimal()

```

Figure shows the density for the updating frequency

<!--Plot Micro data updating share by the SCE all in one-->
```{r, echo=FALSE, warning=FALSE, fig.cap = "Updating Shares from the Micro-data"}


SCE_micro_summary <-bind_cols(SCE_micro_1, SCE_micro_2[2])%>%
  filter(monthly_count>0)%>%
  mutate("Updating share"=monthly_count/n)

ggplot(data=SCE_micro_summary) + aes(x=Date, y = `Updating share`) + geom_line(size=1,color="#440154FF")+labs(x="Years",y="Updating Share")+scale_x_date(date_labels = "%Y",date_breaks = "year")+ theme_minimal()

```

Figure shows the updating share over the whole sample


## Regressions

-due to the shorter time series for the micro data we build two different regression tables with them we perform the different regressions


<!--Regressions-->
```{r, include=FALSE, warning= FALSE}
#transfer data into big regression summary, but without updating behavior
SCE_Data_regressions <-bind_cols(SCE_Data_summary,infl_summary[42:148,2:3])%>%
  rename(GS_infl=Inflation, GS_infl_r=`Inflation rate`)

#second regression table for updating and Google searches
SCE_Data_regressions_micro <-bind_cols(SCE_Data_summary[2:98,],SCE_micro_summary[4],infl_summary[43:139,2:3])%>%rename(GS_infl=Inflation, GS_infl_r=`Inflation rate`)

```

We have now regressions to test our first hypothesis:

-there is a positive correlation between aggregated inflation expectations and uncertainty, Google searches and the actual inflation
-first regression model with aggregated data: uncertainty~ GS_infl+GS_infl_r
-second regression model with aggregated data: Median~ GS_infl+GS_infl_r
- third regression model with aggregated data: median of exp~ GS_infl+GS_infl_r+Uncertainty+CPI

<!--Regression Model aggregated data-->
```{r, echo=FALSE, warning=FALSE, results='asis'}

#regression models
attach(SCE_Data_regressions)
model1 <- lm(Uncertainty~GS_infl+GS_infl_r)
model2 <- lm(Median~ GS_infl+GS_infl_r)
model3 <- lm(`Point Prediction`~ GS_infl+GS_infl_r+Uncertainty+CPI)
detach(SCE_Data_regressions)

#results for full sample aggr. data
stargazer(model1,model2,model3, header=FALSE, type='latex',model.numbers= FALSE,title = "Regressions for aggregated Data, full sample",omit.stat = c("rsq", "f"))


```


- we also differ between the two sub time-series to analyze if the correlations differ in the two phases

<!--Regression Model aggregated data sub-->
```{r, echo=FALSE, warning=FALSE}

#building sub sets
SCE_Data_regressions_01 <- SCE_Data_regressions%>%
  filter(Date<"2020-03-01")

SCE_Data_regressions_02 <- SCE_Data_regressions%>%
  filter(Date>"2020-02-01")

```

-we build two models for the first interval to analyze the effect of CPI

<!--Regression Models aggregated data sub1-->
```{r, echo=FALSE, warning=FALSE, results='asis'}

attach(SCE_Data_regressions_01)
model1_01 <- lm(Uncertainty~GS_infl+GS_infl_r)
model2_01 <- lm(Median~GS_infl+GS_infl_r)
model3_01 <- lm(`Point Prediction`~ GS_infl+GS_infl_r+Uncertainty+SCE_Data_regressions_01$CPI)
detach(SCE_Data_regressions_01)

stargazer(model1_01,model2_01,model3_01, header=FALSE, type='latex',model.numbers= FALSE,title = "Regressions for aggregated Data, sample from 06/13-02/20",omit.stat = c("rsq", "f"))

```

- we do the same regressions with our second sub time-series

<!--Regression Models aggregated data sub2-->
```{r, echo=FALSE, warning=FALSE, results='asis'}

attach(SCE_Data_regressions_02)
model1_02 <- lm(Uncertainty~GS_infl+GS_infl_r)
model2_02 <- lm(Median~GS_infl+GS_infl_r)
model3_02 <- lm(`Point Prediction`~ GS_infl+GS_infl_r+Uncertainty+SCE_Data_regressions_02$CPI)
detach(SCE_Data_regressions_02)

stargazer(model1_02,model2_02,model3_02, header=FALSE, type='latex',model.numbers= FALSE,title = "Regressions for aggregated Data, sample 03/20-04/22",omit.stat = c("rsq", "f"))




```

We can now look at the second hypothesis:

-there is a positive correlation between Google searches and updating behavior of individual consumers
-use of different models

<!--Regression Model micro data 1-->
```{r, echo=FALSE, warning=FALSE, results='asis'}
#regressions for micro data
attach(SCE_Data_regressions_micro)
model1_micro <- lm(`Updating share`~ GS_infl+GS_infl_r)
model2_micro <- lm(Uncertainty~ `Updating share`)

stargazer(model1_micro,model2_micro, header=FALSE, type='latex',model.numbers= FALSE,title = "Regressions for Micro-Data",omit.stat = c("rsq", "f"))


```





